<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon Jan 22 22:28:21 2024 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>fcopy</title>

</head>
<body>

<h1 align="center">fcopy</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#SCRIPTS">SCRIPTS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">fcopy - copy
files using classes</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>fcopy</b>
[<i>options</i>] <i>SOURCE</i>...</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copy a file
from SOURCE to its target using classes. It also sets
permission modes for owner and group. Each SOURCE argument
is a directory which contains one or more template files for
the source file to copy. Depending on the list of defined
classes, one file of the source directory is selected and
copied to the target. The target filename is the name of the
source directory.</p>

<p style="margin-left:11%; margin-top: 1em">The exit code
returned by fcopy is 0 if all files are copied successfully
and &gt;0 if an error occurs. For every successfully copied
file, a log message is printed to standard output.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Options -c, -s,
-t and a SOURCE are required. Usually -c, -s and -t</p>

<p style="margin-left:22%;">are set via variables in
FAI.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>-B</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Remove backup files with suffix .pre_fcopy. You can also
set the environment variable FCOPY_NOBACKUP to 1.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>-b</b> <i>dir</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Don&rsquo;t copy files to file.pre_fcopy, but use
hierarchy under &quot;dir&quot; instead. The same effect is
achieved by setting environment variable FAI_BACKUPDIR.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-c</b>
<i>class[,class]</i></p>

<p style="margin-left:22%;">Define classes. Multiple
classes must be comma separated. If not specified, use the
shell environment variable $classes (space separated). The
first class has lowest priority.</p>

<p style="margin-left:11%;"><b>-C</b> <i>file</i></p>

<p style="margin-left:22%;">Read classes from <i>file</i>.
Lines can contain multiple classes which are space
separated. Lines starting with # are comments.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-d</b></p></td>
<td width="8%"></td>
<td width="60%">


<p>Delete target file if no class applies.</p></td>
<td width="18%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-D</b></p></td>
<td width="8%"></td>
<td width="60%">


<p>Create debugging output.</p></td>
<td width="18%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>-F</b> <i>file</i></p>

<p style="margin-left:22%;">Read list of sources from
<i>file</i>. One SOURCE per line.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-h</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Show help, version and summary of options.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-H</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>If source is a symbolic link, make destination a
symbolic link too.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-i</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Ignore warnings about no matching class and non-existing
source directories. These warnings will not set the exit
code to 1.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-I</b> <i>dir[,dir]</i></p>

<p style="margin-left:22%;">Override list of ignored
directories when recursing. If not given, it is taken from
$FCOPY_IGNOREDIRS and as a last chance an internal list of
known revision control system&rsquo;s metadata is used (CVS,
.cvs, {arch}, .arch-ids).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-l</b></p></td>
<td width="8%"></td>
<td width="69%">


<p>Do not copy if destination is a symbolic link</p></td>
<td width="9%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>-L</b> <i>file</i></p>

<p style="margin-left:22%;">Log SOURCE and used class to
<i>file</i>. Output format is <br>
SOURCE CLASS COMMENT <br>
where COMMENT gives some information about why the file has
been preserved. If not specified and $LOGDIR is set, use
$LOGDIR/fcopy.log.</p>

<p style="margin-left:11%;"><b>-m</b>
<i>user,group,mode</i></p>

<p style="margin-left:22%;">Set user, group and mode for
all copied files (mode as octal number, user and group
numeric id or name). If not specified, use file file-modes
or data of source file.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-M</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Use default values for user, group and mode. This is
equal to -m root,root,0644</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-n</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Print the commands, but do not execute them. This is
like --dry-run in other programs. You can enable it for all
calls of fcopy by setting the environment variable
$FCOPY_DRYRUN.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-r</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Copy recursively (traverse down the tree). Copy all
files below SOURCE. These are all subdirectory leaves in the
SOURCE tree. Ignore &quot;ignored&quot; directories (see
&quot;-I&quot; for details).</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-s</b> <i>source_dir</i></p>

<p style="margin-left:22%;">Look for SOURCE files relative
to <i>source_dir</i>. Use $FAI/files if not specified.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-S</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Enable variable substitution. Every occurrence of the
pattern {%varname%} will be substituted by the value of the
shell variable $varname which is mostly set in
class/CLASSNAME.var. You can enable it for all calls of
fcopy by setting the environment variable $FCOPY_SUBSTITUTE.
Variable substitution is done before the execution of the
preinst script.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-t</b> <i>target_dir</i></p>

<p style="margin-left:22%;">Copy files relative to
<i>target_dir</i>. Use $FAI_ROOT if not specified.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-U</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>If in softupdate mode skip this entire fcopy
command.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-v</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Create verbose output.</p></td></tr>
</table>

<h2>SCRIPTS
<a name="SCRIPTS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>preinst</b></p>

<p style="margin-left:22%;">If a file &rsquo;preinst&rsquo;
exists and is executable, it is used in the following
way:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="3%">


<p>1.</p></td>
<td width="1%"></td>
<td width="74%">


<p>a temporary copy of the file for the used class is
created</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="3%">


<p>2.</p></td>
<td width="1%"></td>
<td width="74%">


<p>preinst is called with the used class and the full
pathname to this temporary copy (you can do in-place
substitutions or other modifications on this copy)</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="3%">


<p>3.</p></td>
<td width="1%"></td>
<td width="74%">


<p>the copy is compared to the destination and replaces it
only if there are any differences and if the preinst scripts
has a exit code zero.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>postinst</b></p>

<p style="margin-left:22%;">If a file
&rsquo;postinst&rsquo; exists and is executable, it is
called after successfully having copied the file. It is
called with two parameters, the class being used and the
full pathname to the target file. The variable ROOTCMD is
set, so you can prepend it to commands which should be
executed in the newly installed system.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Suppose the
source directory /files/etc/X11/xorg.conf consists of the
following files:</p>

<p style="margin-left:11%; margin-top: 1em">CAD DEFAULT LAB
MACH64 server1 ant04 postinst</p>

<p style="margin-left:11%; margin-top: 1em">Each file is an
instance of a xorg.conf file for a different Xserver
configuration. The command</p>

<p style="margin-left:11%; margin-top: 1em"># fcopy -s
/files -t /target /etc/X11/xorg.conf</p>

<p style="margin-left:11%; margin-top: 1em">copies one of
these files from the directory /files/etc/X11/xorg.conf to
the file /target/etc/xorg.conf. For all defined classes,
fcopy looks if a corresponding file exists. The class with
the highest priority that matches an existing file name will
be used for copying. Here are examples of defined classes
for different hosts and the file which will be copied by
fcopy.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="15%"></td>
<td width="42%">


<p>Host belongs to the classes</p></td>
<td width="5%"></td>
<td width="27%">


<p>File used for copy</p></td>
<td width="11%">
</td></tr>
<tr valign="top" align="left">
<td width="15%"></td>
<td width="42%">


<p>DEFAULT,LAB,server3</p></td>
<td width="5%"></td>
<td width="27%">


<p>LAB</p></td>
<td width="11%">
</td></tr>
<tr valign="top" align="left">
<td width="15%"></td>
<td width="42%">


<p>DEFAULT,CAD,server1</p></td>
<td width="5%"></td>
<td width="27%">


<p>server1</p></td>
<td width="11%">
</td></tr>
<tr valign="top" align="left">
<td width="15%"></td>
<td width="42%">


<p>DEFAULT,MACH64,ant01</p></td>
<td width="5%"></td>
<td width="27%">


<p>MACH64</p></td>
<td width="11%">
</td></tr>
<tr valign="top" align="left">
<td width="15%"></td>
<td width="42%">


<p>DEFAULT,TFT,ant13</p></td>
<td width="5%"></td>
<td width="27%">


<p>DEFAULT server1</p></td>
<td width="11%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">In FAI the list
of defined classes starts with DEFAULT and the last class is
the hostname. DEFAULT is only used when no file for another
class exists. If a file is equal to the hostname, this will
be used, since hostname should always be the last class.</p>

<p style="margin-left:11%; margin-top: 1em">User, group and
permissions for the files can be defined in several ways.
The file file-modes in the source directory has the highest
priority, followed by modes specified by -m/-M. If neither
applies, the modes from the source file are used.</p>

<p style="margin-left:11%; margin-top: 1em">The file
file-modes in the source directory can contain one line for
each class. The space separated parameters are:</p>

<p style="margin-left:11%; margin-top: 1em">owner group
mode class</p>

<p style="margin-left:11%; margin-top: 1em">Where owner and
group can be specified by numeric id or by name. The file
permissions are defined by mode, which must be octal. If
class is missing, the data is used for all other classes,
for which no data is defined. If neither -m or file-modes
data is available, the user, group and mode of the source
file will be used for the target file.</p>

<p style="margin-left:11%; margin-top: 1em">Missing
subdirectories for the target file are created with mode
0755. If the destination file already exists and is
different from the source file, the suffix .pre_fcopy is
appended to the old version of the target file. If source
and target files are equal, no copy is performed. A copied
file gets the same access and modification time as the
source file, not the time of the copy. If the file postinst
exists, it will be executed after the file was copied.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Do not create a
file DEFAULT if no reasonable default configuration file can
be used. It&rsquo;s better to exit with an error than to
copy a wrong configuration file.</p>

<p style="margin-left:11%; margin-top: 1em">This command
can also be used to maintain your configuration files on a
huge number of hosts.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>ftar</i>(8)</p>

<p style="margin-left:11%; margin-top: 1em">This program is
part of FAI (Fully Automatic Installation). See the FAI
manual for more information on how to use fcopy. The FAI
homepage is https://fai-project.org.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Thomas Lange
&lt;lange@cs.uni-koeln.de&gt; <br>
Henning Glawe &lt;glaweh@physik.fu-berlin.de&gt;</p>
<hr>
</body>
</html>
